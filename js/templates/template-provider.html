<div class="providers clear-block">

  <table>
    <thead>
      <tr>
        <th></th>
        <th colspan="3"><%= (p1) ? p1.name : ''%></th>
        <th colspan="3"><%= (p2) ? p1.name : ''%></th>
      </tr>
      <tr>
        <th>Clinical conditions, diagnoses, procedures</th>
        
        <th>Avg chg</th>
        <th>Avg payed</th>
        <th>% payed</th>
        
        <th>Avg chg</th>
        <th>Avg payed</th>
        <th>% payed</th>
      </tr>
    </thead>
    
    <tbody>
      <% _.each(drgs, function(d, i) { %>
        <% var p1found = (p1) ? _.find(p1.charges, function(c) {  return (c.drg === i); }) : false %>
        <% var p2found = (p2) ? _.find(p2.charges, function(c) {  return (c.drg === i); }) : false %>
        
        <% if (p1found || p2found) { %>
          <tr>
            <td><%= d %></td>
      
            <% if (p1found) { %>
              <td><%= _.formatCurrency(p1found.avgCovChg) %></td>
              <td><%= _.formatCurrency(p1found.avgTotPay) %></td>
              <td><%= _.formatPercentage((p1found.avgCovChg - p1found.avgTotPay) / p1found.avgCovChg) %>
            <% } else { %>
              <td colspan="3"><em>no data available</em></td>
            <% } %>
            
            <% if (p2found) { %>
              <td><%= _.formatCurrency(p2found.avgCovChg) %></td>
              <td><%= _.formatCurrency(p2found.avgTotPay) %></td>
              <td><%= _.formatPercentage((p2found.avgCovChg - p2found.avgTotPay) / p2found.avgCovChg) %>
            <% } else { %>
              <td colspan="3"><em>no data available</em></td>
            <% } %>
          </tr>
        <% } %>
      <% }) %>
    </tbody>
  </table>
  
</div>